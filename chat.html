<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ChatApp — Mensajes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/chat.css"/>
</head>
<body>
  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="my-profile" id="myProfile">
        <div class="avatar-wrap">
          <img id="myAvatar" src="" alt=""/>
          <div class="avatar-fallback" id="myAvatarFallback"></div>
        </div>
        <div class="my-info">
          <span class="my-name" id="myName"></span>
          <span class="my-username" id="myUsername"></span>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" title="Agregar contacto" onclick="openAddContact()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/>
            <line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/>
          </svg>
        </button>
        <button class="icon-btn danger" title="Cerrar sesión" onclick="logout()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
            <polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="search-bar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
      <input type="text" id="searchContacts" placeholder="Buscar contacto..." oninput="renderContacts()"/>
    </div>

    <div class="contacts-list" id="contactsList">
      <div class="empty-contacts">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2">
          <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
        </svg>
        <p>Sin contactos aún.<br/>Agrega a alguien para chatear.</p>
      </div>
    </div>
  </aside>

  <!-- ===== CHAT AREA ===== -->
  <main class="chat-area" id="chatArea">
    <!-- Empty state -->
    <div class="chat-empty" id="chatEmpty">
      <div class="chat-empty-icon">
        <svg viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="40" cy="40" r="40" fill="rgba(0,200,83,0.07)"/>
          <path d="M40 18C28.95 18 20 26.95 20 38c0 3.78.99 7.33 2.73 10.4L20 60l11.87-2.67A21.94 21.94 0 0040 58c11.05 0 20-8.95 20-20S51.05 18 40 18z" stroke="#00C853" stroke-width="1.5" fill="none"/>
        </svg>
      </div>
      <h2>Bienvenido a ChatApp</h2>
      <p>Selecciona un contacto para comenzar a chatear.</p>
    </div>

    <!-- Chat header -->
    <div class="chat-header hidden" id="chatHeader">
      <button class="back-btn" onclick="closeChat()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <div class="chat-contact-info">
        <div class="avatar-wrap sm">
          <img id="chatAvatar" src="" alt=""/>
          <div class="avatar-fallback sm" id="chatAvatarFallback"></div>
        </div>
        <div>
          <span class="chat-contact-name" id="chatContactName"></span>
          <span class="chat-contact-status">en línea</span>
        </div>
      </div>
    </div>

    <!-- Messages -->
    <div class="messages-wrap hidden" id="messagesWrap">
      <div class="messages" id="messages"></div>
    </div>

    <!-- Input -->
    <div class="chat-input-area hidden" id="chatInputArea">
      <div class="chat-input-wrap">
        <textarea id="msgInput" placeholder="Escribe un mensaje..." rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" onclick="sendMessage()">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>
  </main>

  <!-- ===== MODAL: Agregar contacto ===== -->
  <div class="modal-overlay hidden" id="addContactModal" onclick="closeModal(event)">
    <div class="modal">
      <h3>Agregar contacto</h3>
      <p class="modal-sub">Ingresa el nombre de usuario exacto de la persona.</p>
      <div class="form-group">
        <input type="text" id="addContactInput" placeholder="Nombre de usuario" autocomplete="off"/>
      </div>
      <p class="form-error" id="addContactError"></p>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="document.getElementById('addContactModal').classList.add('hidden')">Cancelar</button>
        <button class="btn-primary" onclick="addContact()">Agregar</button>
      </div>
    </div>
  </div>

  <script src="js/storage.js"></script>
  <script src="js/chat.js"></script>
</body>
</html>